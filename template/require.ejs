function Require(modules, modulePath) {
    var currentModuleDir = modulePath.replace(/\/[^\/]*\.(json|js)$/gi, '');

    <%= resolveFunctions %>
    this.resolve = resolve;
    return function require(path) {
        var resolved = resolve(path);
        
        if(requiringModules[resolved] && console && console.warn) {
            console.error('node2browser error: circular dependency detected.');
            console.error('module ' + modulePath + ' is requiring ' + resolved + ' and vice versa.');

            return undefined;
        }
        requiringModules[modulePath] = true;
        initModule(resolved);
        delete requiringModules[modulePath];

        return modules[resolved];
    };
};